#!/bin/bash

# Access bookmarks and open a browser tab with an optional parameter

list="$XDG_CONFIG_HOME/bookmarks.list"
list_local="$XDG_CONFIG_HOME/bookmarks.local.list"

# Editing bookmarks lists
[ "$1" = '-e' ] && nvim "$list" && exit 0
[ "$1" = '-el' ] && nvim "$list_local" && exit 0

list=$(cat "$list" "$list_local" 2> /dev/null)

# Listing all bookmarks
[ "$1" = '-l' ] && echo "$list" && exit 0

# Use fzf to select one of the URLs
url=$(printf '%s\n' "${list[@]}" | fzf -i)

# If selection was canceled then exit
[ ! "$url" ] && exit 1

# Extract the text inside the curly braces {}
placeholder=$(echo "$url" | grep -oP '{.*?}' | tr -d '{}')

if [ "$placeholder" ]; then
    # Prompt the user for input to replace the placeholder
    read -rp "$placeholder: " input

    # Replace the placeholder with the user input
    url="${url//\{$placeholder\}/$input}"
fi

xdg-open "https://$url"
